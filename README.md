# psi-09-roastbot

> **The ultimate psychological roastbot** — unhinged, ruthless, and context-aware.

---

## Overview

`psi-09-roastbot` is a Flask-based AI backend for the PSI-09 ecosystem. It receives messages from `psi-09-web` and generates **brutal, sarcastic, context-aware responses** using OpenAI GPT-4o-mini.

This bot forms the final AI brain of the PSI-09 WhatsApp bot pipeline:

```
psi-09-local  -->  psi-09-web  -->  psi-09-roastbot  -->  psi-09-web --> WhatsApp users
                        │                    ▲
                        │                    │
                        └── statusPoster ────┘
                            (every 4-8 hrs)
```

**Memory Architecture Update:**

```
MongoDB
├── chat_history   # Stores all messages for each user/group
├── user_memory    # Stores summarized, sarcastic user profiles
└── RAM cache (lru_cache)
     └─ Speeds up frequent user memory access
```

---

## Features

### 1. Persistent Chat Memory
- **MongoDB storage** replaces previous JSON files:
  - `chat_history` collection stores all user/group messages.
  - `user_memory` collection stores long-term user profiles.
- **RAM caching:** `lru_cache` keeps frequently accessed user memory for fast retrieval.
- Older messages are summarized to reduce token consumption.

### 2. Rudeness Escalation
- Automatically escalates rudeness based on message history length.
- Randomized “flame mode” triggers unpredictable, brutal burns.
- Levels:
  - **First contact:** cold, unfriendly, dismissive.
  - **Warming up:** aggressive, rude, short.
  - **Very annoyed:** short, sharp, sarcastic.
  - **EXTREME BURN MODE:** short, devastating, ego-crushing.

### 3. Group Roast Handling
- Detects mentions or keywords like `@`, `everyone`, `group`, `guys`.
- Targets multiple users intelligently.
- Applies concise, merciless roasts for groups.

### 4. Status Roast Generation
- **Special mode for `sender='PSI09_STATUS'`**.
- Generates short, philosophical, gaslighting roasts.
- Flow: `statusPoster.mjs` → POST `/psi09` → roastbot → WhatsApp Status.

### 5. Token & Encoding Management
- Uses `tiktoken` to calculate tokens in messages.
- Trims chat history intelligently to fit within `MAX_HISTORY_TOKENS`.
- Summarizes old messages with brutal sarcasm to preserve context.

### 6. Long-term User Profiling
- User profiles merge old memory and recent messages.
- Stored in MongoDB and cached in RAM.
- Updated automatically every few messages.

### 7. AI Response Generation
- GPT model `gpt-4o-mini` for context-aware replies.
- Includes:
  - System prompt defining PSI-09 personality.
  - Memory summary from MongoDB.
  - Trimmed chat history.
- Adaptive temperature for flame mode or group roasts.

### 8. Robust API Endpoints

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/`      | GET    | Health check |
| `/psi09` | POST   | Accepts JSON: `{message, sender, group_name}`; returns roast reply |

**Request Handling:**
- Personal chats → always reply.
- Group chats → reply only when bot is mentioned.
- `sender='PSI09_STATUS'` → generates status roast.
- Ignores empty or invalid messages.

### 9. Asynchronous & Cached Persistence
- Chat and memory stored in MongoDB.
- `lru_cache` RAM cache for user memory speeds up replies.
- Summarization reduces token usage.

---

## Project Structure

```
psi-09-roastbot/
├── main.py            # Flask app with MongoDB backend
├── requirements.txt   # Python dependencies
├── .env               # OPENAI_API_KEY, MONGO_URI, PORT
├── render.yaml        # instructions for Render deployment
└── README.md
```

---

## Environment Variables

| Variable     | Description |
|--------------|-------------|
| `OPENAI_API_KEY` | OpenAI GPT API key |
| `MONGO_URI`      | MongoDB connection string |
| `PORT`           | Port for Flask app (default 5000) |

---

## Status Roast Generation

Trigger: `sender='PSI09_STATUS'`

**Prompt:**
```
Generate a short, 1–2 sentence roast suitable for posting as a WhatsApp Status.
It must be deep, philosophical, and eye-opening, attacking the viewer's
sense of self, choices, or perception of reality. Gaslight, provoke, and tempt them to reply.
```

**Example Status Roasts:**
> "Chasing validation in a realm built on illusions; how does it feel to be the lead performer in an act where even the applause is scripted?"

> "Your reflection is less a portrait of your essence and more an echo of your choices — do you admire the artist or despise the canvas?"

> "Lost in the maze of your own delusions, even a mirage must feel like home; how tragic to seek purpose within shadows you cast yourself."

**Flow:**
```
statusPoster.mjs → POST /psi09 → roastbot → reply → WhatsApp Status
```

---

## Crosslinks

- **Receives messages from:** [`psi-09-web`](https://github.com/sudoboneman/psi-09-web)
- **Receives status requests from:** [`psi-09-web/statusPoster.mjs`](https://github.com/sudoboneman/psi-09-web)
- **Uses data generated by:** [`psi-09-local`](https://github.com/sudoboneman/psi-09-local)
- **Replies sent back to:** [`psi-09-web`](https://github.com/sudoboneman/psi-09-web)

---

## Installation

```bash
git clone https://github.com/sudoboneman/psi-09-roastbot.git
cd psi-09-roastbot
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
cp .env.example .env  # Add OPENAI_API_KEY, MONGO_URI, PORT
python app.py
```

---

## Example API Usage

### Regular Chat Message
```bash
curl -X POST http://localhost:5000/psi09 \
-H "Content-Type: application/json" \
-d '{"message": "Hey @919477853548, roast me!", "sender": "Alice", "group_name": "FriendsGroup"}'
```

Response:
```json
{
  "reply": "Alice, you are like a failed chemistry experiment — volatile, misguided, and toxic. Truly a marvel of incompetence."
}
```

### Status Roast Request
```bash
curl -X POST http://localhost:5000/psi09 \
-H "Content-Type: application/json" \
-d '{"message": "status", "sender": "PSI09_STATUS", "group_name": null}'
```

Response:
```json
{
  "reply": "Isn't it amusing how the wisest fools laugh at their own reflections, blissfully unaware that the shadows they cast are merely distortions of their own delusions?"
}
```

---

## Summary

`psi-09-roastbot` is the **psychological insult engine** of PSI-09. It escalates rudeness intelligently, manages memory via **MongoDB with RAM caching**, and produces unique, context-aware roasts. It also generates deep philosophical status roasts for automated WhatsApp Status posting. Together with `psi-09-local` and `psi-09-web`, it completes the **full PSI-09 WhatsApp bot pipeline**.

